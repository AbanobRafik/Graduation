<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>قائمة الدروس</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f4f8;
        padding: 20px;
        margin: 0;
        color: #2c3e50;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        margin-bottom: 20px;
        text-align: center;
        color: #2c3e50;
      }

      ul {
        list-style: none;
        padding: 0;
        max-width: 600px;
        width: 100%;
      }

      li {
        background-color: #ffffff;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: background-color 0.3s;
      }

      li:hover {
        background-color: #dbeeff;
      }

      .info {
        font-size: 18px;
        margin-bottom: 20px;
        color: #34495e;
      }
    </style>
  </head>

  <body>
    <h1>قائمة الدروس</h1>
    <div class="info" id="info"></div>
    <ul id="lessons-list"></ul>

    <script>
      const params = new URLSearchParams(window.location.search);
      const term = params.get("term");
      const grade = params.get("grade");
      const subject = params.get("subject");

      const lessonsList = document.getElementById("lessons-list");
      const infoDiv = document.getElementById("info");

      if (!term || !grade || !subject) {
        alert("يرجى اختيار الترم والسنة والمادة أولاً.");
        window.location.href = "term.html";
      } else {
        // عرض الترم والسنة والمادة
        infoDiv.textContent = `الترم: ${translateTerm(
          term
        )} | السنة: ${translateGrade(grade)} | المادة: ${translateSubject(
          subject
        )}`;
        fetchLessonsTitles(term, grade, subject);
      }

      async function fetchLessonsTitles(term, grade, subject) {
        try {
          const res = await fetch(
            `http://localhost:5000/api/${term}/titles/${grade}/${subject}`
          );
          const lessons = await res.json();

          lessonsList.innerHTML = "";

          if (lessons.length === 0) {
            lessonsList.innerHTML = "<li>لا يوجد دروس حالياً.</li>";
            return;
          }

          lessons.forEach((lesson) => {
            const li = document.createElement("li");
            li.textContent = `الدرس ${lesson.id}: ${lesson.title}`;
            li.addEventListener("click", () => {
              window.location.href = `lesson.html?term=${term}&grade=${grade}&subject=${subject}&id=${lesson.id}`;
            });
            lessonsList.appendChild(li);
          });
        } catch (err) {
          lessonsList.innerHTML =
            "<li style='color: red;'>فشل في تحميل عناوين الدروس. تأكد من الاتصال بالخادم.</li>";
          console.error("خطأ في جلب البيانات:", err);
        }
      }

      // دوال للترجمة من الإنجليزي للعربي للعرض
      function translateTerm(term) {
        return term === "first-term"
          ? "الأول"
          : term === "second-term"
          ? "الثاني"
          : term;
      }

      function translateGrade(grade) {
        const grades = {
          fourthgrade: "رابعة ابتدائي",
          fifthgrade: "خامسة ابتدائي",
          sixthgrade: "سادسة ابتدائي",
        };
        return grades[grade] || grade;
      }

      function translateSubject(subject) {
        const subjects = {
          science: "علوم",
          math: "رياضيات",
          arabic: "عربي",
        };
        return subjects[subject] || subject;
      }
    </script>
  </body>
</html>
